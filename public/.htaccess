DirectoryIndex index.html

# CORS Headers for PWA
<IfModule mod_headers.c>
  # Allow same-origin access to manifest.json and sw.js
  <FilesMatch "\.(json|js)$">
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type"
  </FilesMatch>
  
  # Ensure proper MIME types
  <FilesMatch "manifest\.json$">
    Header set Content-Type "application/manifest+json"
  </FilesMatch>
  
  <FilesMatch "sw\.js$">
    Header set Content-Type "application/javascript"
    Header set Service-Worker-Allowed "/"
  </FilesMatch>
</IfModule>

<IfModule mod_rewrite.c>
RewriteEngine On

# Reverse-proxy API calls to Render when hosted under /mdlbeast.
# Frontend calls use a relative base (api/*), so requests resolve to /mdlbeast/api/*.
# Requires mod_proxy + mod_proxy_http enabled on the host.
<IfModule mod_proxy.c>
<IfModule mod_proxy_http.c>
RewriteRule ^api/(.*)$ https://mdlbeast.onrender.com/api/$1 [P,L,QSA]
</IfModule>
</IfModule>

# Block any requests to wp-includes to prevent 404 errors
RewriteRule ^wp-includes/ - [R=404,L]

# Never rewrite Next assets
RewriteRule ^_next/ - [L]

# Serve existing files/directories as-is
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Fallback (helps when a user opens /dashboard without trailing slash on some hosts)
RewriteRule ^ index.html [L]
</IfModule>

# Security: prevent directory listing
<IfModule mod_autoindex.c>
  Options -Indexes
</IfModule>
