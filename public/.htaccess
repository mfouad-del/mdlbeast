# Public root-level .htaccess to protect /archive from site-wide redirects and WordPress rewrites

# Ensure requests to /_next and /static are served from /archive
<IfModule mod_rewrite.c>
  RewriteEngine On
  # Internally map requests like /_next/* -> /archive/_next/* (avoid WP catching them)
  RewriteRule ^_next/(.*)$ /archive/_next/$1 [L]
  RewriteRule ^static/(.*)$ /archive/static/$1 [L]
</IfModule>

# Force canonical host: redirect www to non-www (preserve path)
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteCond %{HTTP_HOST} ^www\.zaco\.sa$ [NC]
  RewriteRule ^(.*)$ https://zaco.sa/$1 [R=301,L]
</IfModule>

<IfModule mod_rewrite.c>
  RewriteEngine On

  # Ensure /archive is not rewritten to WordPress index.php
  RewriteRule ^archive/ - [L]
</IfModule>

# Keep WordPress block but ensure it won't capture /archive
# BEGIN WordPress
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  RewriteRule ^index\.php$ - [L]
  RewriteCond %{REQUEST_URI} !^/archive/    # <-- ensure archive is excluded
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.php [L]
</IfModule>
# END WordPress

# Safe CORS for font files (applies on both www and non-www)
<IfModule mod_headers.c>
  <FilesMatch "\.(ttf|otf|eot|woff|woff2)$">
    Header set Access-Control-Allow-Origin "*"
    # Also set CORS for cross-host fetches
    Header set Access-Control-Allow-Methods "GET, OPTIONS"
  </FilesMatch>
</IfModule>

# Security: prevent directory listing
<IfModule mod_autoindex.c>
  Options -Indexes
</IfModule>
