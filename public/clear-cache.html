<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Cache | حل مشكلة تسجيل الدخول</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background: #0b1220;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #0f172a;
        }
        .bg {
            position: fixed;
            inset: 0;
            background:
              radial-gradient(900px 450px at 20% 10%, rgba(79,70,229,0.30), transparent 60%),
              radial-gradient(800px 400px at 80% 30%, rgba(14,165,233,0.18), transparent 60%),
              radial-gradient(950px 520px at 50% 95%, rgba(16,185,129,0.14), transparent 60%),
              #0b1220;
            pointer-events: none;
        }
        .container {
            background: rgba(255,255,255,0.98);
            padding: 28px;
            border-radius: 26px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.45);
            max-width: 520px;
            width: 100%;
            text-align: center;
            border: 1px solid rgba(226,232,240,0.8);
            backdrop-filter: blur(12px);
        }
        h1 { color: #0b1220; font-size: 22px; font-weight: 900; margin-bottom: 10px; letter-spacing: -0.01em; }
        .subtitle { color: #475569; font-size: 12px; margin-bottom: 30px; font-weight: 700; }
        .status {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
        }
        .status-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
        }
        .status-item:last-child { margin-bottom: 0; }
        .label { font-weight: 900; color: #334155; font-size: 12px; }
        .badge { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 900; }
        .badge.success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .badge.warning { background: #ffedd5; color: #9a3412; border: 1px solid #fed7aa; }
        button {
            background: #0f172a;
            color: white;
            border: none;
            padding: 14px 18px;
            font-size: 14px;
            font-weight: 900;
            border-radius: 16px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 12px 30px rgba(15, 23, 42, 0.35); }
        button:active { transform: translateY(0); }
        .btn-secondary { background: #fff; color: #0f172a; border: 1px solid #cbd5e1; }
        .btn-secondary:hover { background: #f8fafc; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .success-message {
            background: #c6f6d5;
            border: 2px solid #9ae6b4;
            color: #22543d;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
            font-weight: 600;
        }
        .icon {
            width: 56px; height: 56px;
            margin: 0 auto 16px;
            border-radius: 18px;
            background: linear-gradient(135deg, #0f172a, #111827);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            box-shadow: 0 12px 28px rgba(15, 23, 42, 0.25);
        }
        .lang-toggle {
            position: absolute;
            top: 10px;
            inset-inline-end: 10px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            color: #475569;
            width: auto;
            margin-bottom: 0;
        }
        .lang-toggle:hover { background: #f1f5f9; }

        @media (max-width: 420px) {
            body { padding: 12px; }
            .container { padding: 18px; border-radius: 22px; }
            h1 { font-size: 18px; }
            .subtitle { margin-bottom: 18px; }
            button { border-radius: 14px; }
        }
    </style>
</head>
<body>
    <div class="bg"></div>
    <div class="container" style="position: relative;">
        <button class="lang-toggle" onclick="toggleLang()">العربية</button>
        <div class="icon">CC</div>
        <h1 id="title">Fix Login Issues</h1>
        <p class="subtitle" id="subtitle">Clear saved session data to fix “Access token required”</p>
        
        <div class="status">
            <div class="status-item">
                <span class="label">Token:</span>
                <span class="badge warning" id="token-status">موجود</span>
            </div>
            <div class="status-item">
                <span class="label">Documents Cache:</span>
                <span class="badge warning" id="docs-status">موجود</span>
            </div>
            <div class="status-item">
                <span class="label">User Session:</span>
                <span class="badge warning" id="user-status">موجود</span>
            </div>
        </div>

        <button id="clearBtn" onclick="clearAllData()">مسح البيانات الآن</button>
        <button class="btn-secondary" id="backBtn" onclick="goBack()">الرجوع</button>
        
        <div class="success-message" id="success">✅ تم المسح بنجاح! يرجى إعادة تسجيل الدخول</div>
    </div>

    <script>
        // Default to English inside the modal/page (per product requirement)
        var lang = 'en';
        var i18n = {
            ar: {
                title: 'حل مشكلة تسجيل الدخول',
                subtitle: 'مسح بيانات الجلسة لإصلاح مشكلة Access token required',
                clearBtn: 'مسح البيانات الآن',
                backBtn: 'الرجوع',
                success: '✅ تم المسح بنجاح! يرجى إعادة تسجيل الدخول',
                exists: 'موجود',
                empty: 'فارغ',
                toggle: 'English'
            },
            en: {
                title: 'Fix Login Issues',
                subtitle: 'Clear saved session data to fix “Access token required”',
                clearBtn: 'Clear Data Now',
                backBtn: 'Go Back',
                success: '✅ Cleared successfully! Please login again',
                exists: 'Exists',
                empty: 'Empty',
                toggle: 'العربية'
            }
        };

        function toggleLang() {
            lang = lang === 'ar' ? 'en' : 'ar';
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.querySelector('.lang-toggle').textContent = i18n[lang].toggle;
            document.getElementById('title').textContent = i18n[lang].title;
            document.getElementById('subtitle').textContent = i18n[lang].subtitle;
            document.getElementById('clearBtn').textContent = i18n[lang].clearBtn;
            document.getElementById('backBtn').textContent = i18n[lang].backBtn;
            document.getElementById('success').textContent = i18n[lang].success;
            checkStorage();
        }

        // Initialize UI based on default language
        (function initLang() {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.querySelector('.lang-toggle').textContent = i18n[lang].toggle;
            document.getElementById('title').textContent = i18n[lang].title;
            document.getElementById('subtitle').textContent = i18n[lang].subtitle;
            document.getElementById('clearBtn').textContent = i18n[lang].clearBtn;
            document.getElementById('backBtn').textContent = i18n[lang].backBtn;
            document.getElementById('success').textContent = i18n[lang].success;
        })();

        function checkStorage() {
            var token = localStorage.getItem('auth_token') || localStorage.getItem('token');
            var docs = localStorage.getItem('archive_docs');
            var user = localStorage.getItem('archive_user') || localStorage.getItem('mdlbeast_session_user');
            
            document.getElementById('token-status').textContent = token ? i18n[lang].exists : i18n[lang].empty;
            document.getElementById('token-status').className = token ? 'badge warning' : 'badge success';
            
            document.getElementById('docs-status').textContent = docs ? i18n[lang].exists : i18n[lang].empty;
            document.getElementById('docs-status').className = docs ? 'badge warning' : 'badge success';
            
            document.getElementById('user-status').textContent = user ? i18n[lang].exists : i18n[lang].empty;
            document.getElementById('user-status').className = user ? 'badge warning' : 'badge success';
        }

        function clearAllData() {
            var keysToRemove = [
                'auth_token', 'token', 'refresh_token', 'archive_docs', 'archive_user',
                'mdlbeast_session_user', 'archivx_session_user', 'archive_tenant', 'selectedTenantId'
            ];
            keysToRemove.forEach(function(key) { localStorage.removeItem(key); });
            sessionStorage.clear();
            checkStorage();
            document.getElementById('success').style.display = 'block';
            try { window.parent && window.parent.postMessage({ type: 'mdlbeast:clear-cache:done' }, '*'); } catch (e) {}
        }

        function goBack() {
            try { window.parent && window.parent.postMessage({ type: 'mdlbeast:clear-cache:close' }, '*'); } catch (e) {}
            if (history.length > 1) history.back();
            else window.location.href = '/mdlbeast/';
        }

        checkStorage();
    </script>
</body>
</html>
